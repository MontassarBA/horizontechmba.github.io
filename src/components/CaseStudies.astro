---
import { getLangFromUrl, useTranslations, useTranslatedPath } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

// These represent the type of projects our founder has delivered during 15+ years of consulting experience
const caseStudies = [
  {
    id: 'smart-metering',
    title: lang === 'fr' ? 'Compteur Intelligent DLMS/COSEM' : 'DLMS/COSEM Smart Meter',
    context: lang === 'fr' ? 'Énergie & comptage' : 'Energy & metering',
    industry: lang === 'fr' ? 'Énergie' : 'Energy',
    challenge: lang === 'fr' 
      ? 'Concevoir un compteur fiable et conforme pour la domotique et la gestion énergétique'
      : 'Design a reliable, compliance-ready meter for smart home and energy management',
    solution: lang === 'fr'
      ? 'Conception électronique complète + firmware temps réel, implémentation protocoles DLMS/COSEM Blue Book et modules de mesure/décision embarqués'
      : 'Complete electronics design + real-time firmware, DLMS/COSEM Blue Book protocol implementation and embedded measurement/decision modules',
    results: [
      { metric: '10K+', label: lang === 'fr' ? 'Unités déployées' : 'Units deployed' },
      { metric: '99.8%', label: lang === 'fr' ? 'Fiabilité terrain' : 'Field reliability' },
      { metric: '< 6 mois', label: lang === 'fr' ? 'Mise en marché' : 'Time to market' }
    ],
    tags: ['Embedded', 'DLMS/COSEM', 'Metering', 'Energy'],
    gradient: 'from-green-500 to-emerald-600'
  },
  {
    id: 'medical-embedded',
    title: lang === 'fr' ? 'Dispositif Médical Embarqué' : 'Medical Embedded Device',
    context: lang === 'fr' ? 'Dispositifs médicaux' : 'Medical devices',
    industry: lang === 'fr' ? 'Médical' : 'Medical',
    challenge: lang === 'fr'
      ? 'Développer un système embarqué conforme pour un équipement de diagnostic'
      : 'Develop a compliant embedded system for diagnostic equipment',
    solution: lang === 'fr'
      ? 'Architecture hardware sécurisée, firmware temps réel avec traçabilité complète et plan de validation selon IEC 60601 / IEC 62304'
      : 'Secure hardware architecture, real-time firmware with full traceability and validation plan aligned with IEC 60601 / IEC 62304',
    results: [
      { metric: '100%', label: lang === 'fr' ? 'Certification 1er coup' : 'First-time cert' },
      { metric: '-30%', label: lang === 'fr' ? 'Coûts tests vs budget' : 'Test costs vs budget' },
      { metric: '8 mois', label: lang === 'fr' ? 'Durée projet' : 'Project duration' }
    ],
    tags: ['Embedded', 'Medical', 'IEC 60601', 'IEC 62304'],
    gradient: 'from-red-500 to-pink-600'
  },
  {
    id: 'off-highway-safety',
    title: lang === 'fr' ? 'Sécurité Fonctionnelle Hors-route' : 'Off-Highway Functional Safety',
    context: lang === 'fr' ? 'Mines & équipements lourds' : 'Mining & heavy equipment',
    industry: lang === 'fr' ? 'Hors-route' : 'Off-highway',
    challenge: lang === 'fr'
      ? 'Sécuriser des fonctions critiques pour machines mobiles en environnement sévère'
      : 'Secure critical functions for mobile machines in harsh environments',
    solution: lang === 'fr'
      ? 'Analyse FMEA/FMEDA complète, architecture redondante SIL2, plan de validation HIL/SIL selon IEC 61508 / ISO 13849'
      : 'Complete FMEA/FMEDA analysis, SIL2 redundant architecture, HIL/SIL validation plan aligned with IEC 61508 / ISO 13849',
    results: [
      { metric: 'SIL 2', label: lang === 'fr' ? 'Niveau sécurité atteint' : 'Safety level achieved' },
      { metric: '500+', label: lang === 'fr' ? 'Heures tests HIL/SIL' : 'HIL/SIL test hours' },
      { metric: 'Cat. 3', label: lang === 'fr' ? 'ISO 13849 certification' : 'ISO 13849 rating' }
    ],
    tags: ['Safety', 'Off-highway', 'IEC 61508', 'ISO 13849'],
    gradient: 'from-blue-500 to-primary-600'
  }
];

const sectionTitle = lang === 'fr' ? 'Types de Projets' : 'Types of Projects';
const sectionSubtitle = lang === 'fr'
  ? 'Exemples de projets réalisés par notre fondateur au cours de ses 15+ années d\'expérience'
  : 'Examples of projects delivered by our founder over 15+ years of experience';
const badge = lang === 'fr' ? 'Notre Expertise' : 'Our Expertise';
const viewAll = lang === 'fr' ? 'Voir tous les projets' : 'View all projects';
---

<section class="py-24 bg-gradient-to-b from-white to-gray-50/50">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="text-center mb-16">
      <span class="inline-block px-4 py-2 bg-primary-100 text-primary-700 rounded-full text-sm font-semibold mb-4">
        {badge}
      </span>
      <h2 class="text-3xl md:text-5xl font-bold text-gray-900 mb-6">
        {sectionTitle}
      </h2>
      <p class="text-xl text-gray-600 max-w-3xl mx-auto">
        {sectionSubtitle}
      </p>
    </div>
    
    <!-- Case Studies -->
    <div class="space-y-8 max-w-6xl mx-auto">
      {caseStudies.map((study, index) => (
        <div 
          class={`group bg-white/70 backdrop-blur-lg rounded-3xl overflow-hidden shadow-lg shadow-black/5 border border-white/50 hover:shadow-2xl transition-all duration-500 ${index % 2 === 1 ? 'md:flex-row-reverse' : ''}`}
        >
          <div class="md:flex">
            <!-- Visual Side -->
            <div class={`md:w-2/5 bg-gradient-to-br ${study.gradient} p-8 md:p-12 flex flex-col justify-center relative overflow-hidden`}>
              <!-- Abstract decoration -->
              <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"></div>
              <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full translate-y-1/2 -translate-x-1/2"></div>
              
              <div class="relative z-10">
                <span class="inline-block px-3 py-1 bg-white/20 text-white text-sm font-medium rounded-full mb-4">
                  {study.industry}
                </span>
                <h3 class="text-2xl md:text-3xl font-bold text-white mb-4">
                  {study.title}
                </h3>
                <p class="text-white/80 font-medium">
                  {study.context}
                </p>
              </div>
            </div>
            
            <!-- Content Side -->
            <div class="md:w-3/5 p-8 md:p-12">
              <!-- Challenge & Solution -->
              <div class="space-y-6 mb-8">
                <div>
                  <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">
                    {lang === 'fr' ? 'Défi' : 'Challenge'}
                  </h4>
                  <p class="text-gray-700">{study.challenge}</p>
                </div>
                <div>
                  <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">
                    {lang === 'fr' ? 'Solution' : 'Solution'}
                  </h4>
                  <p class="text-gray-700">{study.solution}</p>
                </div>
              </div>
              
              <!-- Results -->
              <div class="grid grid-cols-3 gap-4 mb-8">
                {study.results.map((result) => (
                  <div class="text-center p-4 bg-gray-50/80 rounded-xl">
                    <p class="text-2xl md:text-3xl font-bold text-primary-600">{result.metric}</p>
                    <p class="text-xs text-gray-500 mt-1">{result.label}</p>
                  </div>
                ))}
              </div>
              
              <!-- Tags -->
              <div class="flex flex-wrap gap-2">
                {study.tags.map((tag) => (
                  <span class="px-3 py-1 bg-gray-100 text-gray-600 text-sm rounded-full">
                    {tag}
                  </span>
                ))}
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
    
    <!-- CTA -->
    <div class="text-center mt-12">
      <a 
        href={`${translatePath('/contact')}#booking`}
        class="inline-flex items-center gap-2 px-8 py-4 bg-primary-500 hover:bg-primary-600 text-white font-semibold rounded-xl shadow-lg shadow-primary-500/25 hover:shadow-xl transition-all duration-300 group"
      >
        {lang === 'fr' ? 'Planifier un appel technique' : 'Schedule a Technical Call'}
        <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
        </svg>
      </a>
    </div>
  </div>
</section>
