---
import { getLangFromUrl, useTranslations, useTranslatedPath } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);
---

<section class="relative min-h-screen flex items-center pt-20 overflow-hidden">
  <!-- Background Pattern -->
  <div class="absolute inset-0 bg-gradient-to-br from-primary-50 via-white to-secondary-50"></div>
  <div class="absolute inset-0 opacity-30">
    <svg class="absolute w-full h-full" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
          <path d="M 40 0 L 0 0 0 40" fill="none" stroke="currentColor" stroke-width="0.5" class="text-primary-200"/>
        </pattern>
      </defs>
      <rect width="100%" height="100%" fill="url(#grid)" />
    </svg>
  </div>
  
  <!-- Floating Elements - Hidden on mobile to prevent overflow -->
  <div class="hidden sm:block absolute top-1/4 left-4 sm:left-10 w-16 sm:w-20 h-16 sm:h-20 bg-primary-400/20 rounded-full blur-xl animate-pulse"></div>
  <div class="hidden sm:block absolute bottom-1/4 right-4 sm:right-10 w-24 sm:w-32 h-24 sm:h-32 bg-secondary-400/20 rounded-full blur-xl animate-pulse" style="animation-delay: 1s;"></div>
  <div class="hidden md:block absolute top-1/2 right-1/4 w-16 h-16 bg-primary-300/30 rounded-full blur-lg animate-pulse" style="animation-delay: 0.5s;"></div>
  
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
    <div class="grid lg:grid-cols-2 gap-8 lg:gap-12 items-center">
      <!-- Content -->
      <div class="text-center lg:text-left">
        <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-secondary-900 leading-tight">
          {t('hero.title')}
          <span class="block text-primary-500">
            {t('hero.titleHighlight')}
          </span>
        </h1>
        <p class="mt-6 text-lg sm:text-xl text-secondary-500 max-w-2xl mx-auto lg:mx-0">
          {t('hero.subtitle')}
        </p>
        <div class="mt-10 flex justify-center lg:justify-start">
          <a 
            href={`${translatePath('/contact')}#booking`} 
            class="px-8 py-4 bg-primary-500 hover:bg-primary-600 text-white font-semibold rounded-xl shadow-lg shadow-primary-500/30 hover:shadow-xl hover:shadow-primary-500/40 transform hover:-translate-y-1 transition-all duration-300"
          >
            {t('hero.cta.primary')}
          </a>
        </div>
      </div>
      
      <!-- Illustration -->
      <div class="relative">
        <!-- Mobile version - smaller and centered -->
        <div class="lg:hidden flex justify-center mt-8">
          <div class="relative w-64 h-64 sm:w-80 sm:h-80" style="pointer-events: none;">
            <svg viewBox="0 0 400 400" class="w-full h-full" fill="none" xmlns="http://www.w3.org/2000/svg">
              <!-- Circuit board pattern -->
              <circle cx="200" cy="200" r="150" stroke="url(#gradient1m)" stroke-width="2" fill="none" class="animate-spin" style="animation-duration: 20s;"/>
              <circle cx="200" cy="200" r="120" stroke="url(#gradient2m)" stroke-width="1.5" fill="none" class="animate-spin" style="animation-duration: 15s; animation-direction: reverse;"/>
              <circle cx="200" cy="200" r="90" stroke="url(#gradient1m)" stroke-width="1" fill="none" class="animate-spin" style="animation-duration: 25s;"/>
              
              <!-- Nodes -->
              <circle cx="200" cy="50" r="10" fill="#009999"/>
              <circle cx="350" cy="200" r="10" fill="#009999"/>
              <circle cx="200" cy="350" r="10" fill="#009999"/>
              <circle cx="50" cy="200" r="10" fill="#009999"/>
              <circle cx="290" cy="110" r="7" fill="#33cccc"/>
              <circle cx="290" cy="290" r="7" fill="#33cccc"/>
              <circle cx="110" cy="290" r="7" fill="#33cccc"/>
              <circle cx="110" cy="110" r="7" fill="#33cccc"/>
              
              <!-- Center icon -->
              <circle cx="200" cy="200" r="45" fill="url(#gradient3m)"/>
              <path d="M185 200 L195 210 L215 190" stroke="white" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
              
              <!-- Connection lines -->
              <line x1="200" y1="50" x2="200" y2="155" stroke="#009999" stroke-width="1.5" stroke-dasharray="4 4"/>
              <line x1="350" y1="200" x2="245" y2="200" stroke="#009999" stroke-width="1.5" stroke-dasharray="4 4"/>
              <line x1="200" y1="350" x2="200" y2="245" stroke="#009999" stroke-width="1.5" stroke-dasharray="4 4"/>
              <line x1="50" y1="200" x2="155" y2="200" stroke="#009999" stroke-width="1.5" stroke-dasharray="4 4"/>
              
              <defs>
                <linearGradient id="gradient1m" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#009999"/>
                  <stop offset="100%" stop-color="#006666"/>
                </linearGradient>
                <linearGradient id="gradient2m" x1="100%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" stop-color="#006666"/>
                  <stop offset="100%" stop-color="#009999"/>
                </linearGradient>
                <linearGradient id="gradient3m" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#009999"/>
                  <stop offset="100%" stop-color="#006666"/>
                </linearGradient>
              </defs>
            </svg>
          </div>
        </div>
        
        <!-- Desktop version -->
        <div class="relative w-full aspect-square max-w-lg mx-auto hidden lg:block" style="pointer-events: none;">
          <!-- Abstract Tech Illustration -->
          <svg viewBox="0 0 400 400" class="w-full h-full" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- Circuit board pattern -->
            <circle cx="200" cy="200" r="150" stroke="url(#gradient1)" stroke-width="2" fill="none" class="animate-spin" style="animation-duration: 20s;"/>
            <circle cx="200" cy="200" r="120" stroke="url(#gradient2)" stroke-width="1.5" fill="none" class="animate-spin" style="animation-duration: 15s; animation-direction: reverse;"/>
            <circle cx="200" cy="200" r="90" stroke="url(#gradient1)" stroke-width="1" fill="none" class="animate-spin" style="animation-duration: 25s;"/>
            
            <!-- Nodes -->
            <circle cx="200" cy="50" r="8" fill="#009999"/>
            <circle cx="350" cy="200" r="8" fill="#009999"/>
            <circle cx="200" cy="350" r="8" fill="#009999"/>
            <circle cx="50" cy="200" r="8" fill="#009999"/>
            <circle cx="290" cy="110" r="6" fill="#33cccc"/>
            <circle cx="290" cy="290" r="6" fill="#33cccc"/>
            <circle cx="110" cy="290" r="6" fill="#33cccc"/>
            <circle cx="110" cy="110" r="6" fill="#33cccc"/>
            
            <!-- Center icon -->
            <circle cx="200" cy="200" r="40" fill="url(#gradient3)"/>
            <path d="M185 200 L195 210 L215 190" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            
            <!-- Connection lines -->
            <line x1="200" y1="50" x2="200" y2="160" stroke="#009999" stroke-width="1" stroke-dasharray="4 4"/>
            <line x1="350" y1="200" x2="240" y2="200" stroke="#009999" stroke-width="1" stroke-dasharray="4 4"/>
            <line x1="200" y1="350" x2="200" y2="240" stroke="#009999" stroke-width="1" stroke-dasharray="4 4"/>
            <line x1="50" y1="200" x2="160" y2="200" stroke="#009999" stroke-width="1" stroke-dasharray="4 4"/>
            
            <defs>
              <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#009999"/>
                <stop offset="100%" stop-color="#006666"/>
              </linearGradient>
              <linearGradient id="gradient2" x1="100%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="#006666"/>
                <stop offset="100%" stop-color="#009999"/>
              </linearGradient>
              <linearGradient id="gradient3" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#009999"/>
                <stop offset="100%" stop-color="#006666"/>
              </linearGradient>
            </defs>
          </svg>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Scroll indicator with larger touch area -->
  <button 
    id="scroll-down-btn"
    class="hidden sm:flex absolute bottom-4 sm:bottom-8 left-1/2 transform -translate-x-1/2 cursor-pointer focus:outline-none group z-10"
    aria-label="DÃ©filer vers le bas"
    type="button"
    style="-webkit-tap-highlight-color: transparent; pointer-events: auto;"
  >
    <div class="animate-bounce p-3 sm:p-4 rounded-full hover:bg-primary-50/50 transition-colors">
      <svg class="w-6 h-6 sm:w-8 sm:h-8 text-gray-400 group-hover:text-primary-500 group-active:text-primary-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
      </svg>
    </div>
  </button>
</section>

<script>
  // Smooth scroll for down arrow - optimized for iOS
  function initScrollButton() {
    const scrollBtn = document.getElementById('scroll-down-btn');
    
    if (!scrollBtn) return;
    
    const performScroll = () => {
      const contentSection = document.getElementById('content');
      if (contentSection) {
        const targetPosition = contentSection.offsetTop;
        window.scrollTo({
          top: targetPosition,
          behavior: 'smooth'
        });
      } else {
        window.scrollBy({
          top: window.innerHeight * 0.85,
          behavior: 'smooth'
        });
      }
    };
    
    // Handle click events
    scrollBtn.addEventListener('click', (e) => {
      e.preventDefault();
      performScroll();
    });
    
    // Handle touch events for iOS
    let touchStartY = 0;
    
    scrollBtn.addEventListener('touchstart', (e) => {
      touchStartY = e.touches[0].clientY;
    }, { passive: true });
    
    scrollBtn.addEventListener('touchend', (e) => {
      const touchEndY = e.changedTouches[0].clientY;
      const touchDiff = Math.abs(touchEndY - touchStartY);
      
      // Only scroll if it's a tap (not a swipe)
      if (touchDiff < 10) {
        e.preventDefault();
        performScroll();
      }
    }, { passive: false });
  }
  
  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initScrollButton);
  } else {
    initScrollButton();
  }
</script>
