---
import { getLangFromUrl } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);

const content = {
  fr: {
    badge: 'Newsletter',
    title: 'Restez à la pointe de l\'innovation',
    subtitle: 'Recevez nos analyses techniques, études de cas et tendances du secteur directement dans votre boîte mail.',
    placeholder: 'Votre adresse email',
    button: 'S\'abonner',
    privacy: 'En vous inscrivant, vous acceptez notre politique de confidentialité. Désabonnement possible à tout moment.',
    benefits: [
      'Analyses techniques exclusives',
      'Études de cas détaillées',
      'Veille technologique mensuelle'
    ]
  },
  en: {
    badge: 'Newsletter',
    title: 'Stay at the forefront of innovation',
    subtitle: 'Receive our technical analyses, case studies, and industry trends directly in your inbox.',
    placeholder: 'Your email address',
    button: 'Subscribe',
    privacy: 'By subscribing, you agree to our privacy policy. Unsubscribe at any time.',
    benefits: [
      'Exclusive technical insights',
      'Detailed case studies',
      'Monthly technology watch'
    ]
  }
};

const t = content[lang] || content.en;
---

<section class="py-24 bg-gradient-to-br from-primary-600 via-primary-700 to-primary-800 relative overflow-hidden">
  <!-- Background decorations -->
  <div class="absolute inset-0 overflow-hidden">
    <div class="absolute top-0 left-1/4 w-96 h-96 bg-white/5 rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-primary-400/20 rounded-full blur-3xl"></div>
    <div class="absolute top-1/2 left-0 w-64 h-64 bg-white/5 rounded-full blur-2xl"></div>
  </div>
  
  <!-- Grid pattern -->
  <div class="absolute inset-0 opacity-10">
    <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <pattern id="newsletter-grid" width="40" height="40" patternUnits="userSpaceOnUse">
          <path d="M 40 0 L 0 0 0 40" fill="none" stroke="white" stroke-width="0.5"/>
        </pattern>
      </defs>
      <rect width="100%" height="100%" fill="url(#newsletter-grid)" />
    </svg>
  </div>
  
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
    <div class="max-w-4xl mx-auto">
      <!-- Glassmorphism card -->
      <div class="bg-white/10 backdrop-blur-xl rounded-3xl p-8 md:p-12 border border-white/20 shadow-2xl">
        <div class="text-center mb-10">
          <span class="inline-block px-4 py-2 bg-white/20 text-white rounded-full text-sm font-semibold mb-6">
            ✉️ {t.badge}
          </span>
          <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">
            {t.title}
          </h2>
          <p class="text-lg text-white/80 max-w-2xl mx-auto">
            {t.subtitle}
          </p>
        </div>
        
        <!-- Benefits -->
        <div class="flex flex-wrap justify-center gap-4 md:gap-6 mb-10">
          {t.benefits.map((benefit) => (
            <div class="flex items-center gap-2 text-white/90">
              <svg class="w-5 h-5 text-primary-300" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              <span class="text-sm font-medium">{benefit}</span>
            </div>
          ))}
        </div>
        
        <!-- Form -->
        <form id="newsletter-form" class="max-w-xl mx-auto">
          <div class="flex flex-col sm:flex-row gap-3">
            <div class="flex-1 relative">
              <input 
                type="email" 
                id="newsletter-email"
                name="email"
                required
                placeholder={t.placeholder}
                class="w-full px-6 py-4 bg-white/90 backdrop-blur-sm rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-300 focus:bg-white transition-all duration-300"
              />
            </div>
            <button 
              type="submit"
              class="px-8 py-4 bg-white text-primary-700 font-bold rounded-xl hover:bg-primary-50 hover:shadow-lg hover:shadow-white/20 transition-all duration-300 flex items-center justify-center gap-2 group whitespace-nowrap"
            >
              {t.button}
              <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
              </svg>
            </button>
          </div>
          
          <!-- Success message (hidden by default) -->
          <div id="newsletter-success" class="hidden mt-4 p-4 bg-green-500/20 border border-green-400/30 rounded-xl text-center">
            <p class="text-white font-medium">
              {lang === 'fr' ? '✓ Merci pour votre inscription!' : '✓ Thank you for subscribing!'}
            </p>
          </div>
          
          <!-- Error message (hidden by default) -->
          <div id="newsletter-error" class="hidden mt-4 p-4 bg-red-500/20 border border-red-400/30 rounded-xl text-center">
            <p class="text-white font-medium">
              {lang === 'fr' ? 'Une erreur est survenue. Veuillez réessayer.' : 'An error occurred. Please try again.'}
            </p>
          </div>
        </form>
        
        <!-- Privacy note -->
        <p class="text-center text-white/60 text-sm mt-6 max-w-md mx-auto">
          {t.privacy}
        </p>
      </div>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById('newsletter-form') as HTMLFormElement;
  const successMsg = document.getElementById('newsletter-success');
  const errorMsg = document.getElementById('newsletter-error');
  
  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = (document.getElementById('newsletter-email') as HTMLInputElement).value;
    
    // Hide any previous messages
    successMsg?.classList.add('hidden');
    errorMsg?.classList.add('hidden');
    
    try {
      // Here you would integrate with your email service (Mailchimp, ConvertKit, etc.)
      // For now, we'll simulate a successful submission
      
      // Simulate API call
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      // Track subscription event
      if (typeof gtag !== 'undefined') {
        gtag('event', 'newsletter_signup', {
          event_category: 'engagement',
          event_label: email
        });
      }
      
      // Show success message
      successMsg?.classList.remove('hidden');
      form.reset();
      
    } catch (error) {
      // Show error message
      errorMsg?.classList.remove('hidden');
    }
  });
</script>
