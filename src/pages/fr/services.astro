---
import Layout from '../../layouts/Layout.astro';
import { getLangFromUrl, useTranslations, useTranslatedPath } from '../../i18n/utils';
import CTASection from '../../components/CTASection.astro';
import CaseStudies from '../../components/CaseStudies.astro';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const pageDescription = "Services de consultation en ingénierie: systèmes embarqués et conception électronique, IA & logiciels, comptage intelligent (DLMS/COSEM), dispositifs médicaux (IEC 60601/62304), sécurité fonctionnelle (IEC 61508, ISO 13849), EMI/EMC, HIL/SIL Matlab et automatisation industrielle.";
const pageKeywords = "consultation systèmes embarqués, conception électronique, design PCB, services développement IoT, solutions IA, génie logiciel, comptage intelligent DLMS COSEM, dispositifs médicaux IEC 60601 IEC 62304, sécurité fonctionnelle IEC 61508 ISO 13849, consultant EMI EMC, HIL SIL Matlab, automatisation industrielle, PLC Siemens, vision Cognex";

const standards = ['IEC 60601', 'IEC 62304', 'IEC 61508', 'ISO 13849', 'ISO 26262', 'DLMS/COSEM', 'EMI/EMC'];
const standardsTitle = lang === 'fr' ? 'Certifications & Normes' : 'Certifications & Standards';
const standardsSubtitle = lang === 'fr'
  ? 'Expérience pratique des standards clés pour le médical, l\'énergie et l\'industriel.'
  : 'Hands-on experience with the key standards for medical, energy, and industrial systems.';
const standardsLink = lang === 'fr' ? 'Voir la page Normes & conformité' : 'View Standards & Compliance';
const protocolsTitle = lang === 'fr' ? 'Protocoles & bus de communication' : 'Communication protocols & buses';
const protocols = ['J1939', 'CAN', 'Ethernet', 'Wi-Fi 802.11', 'Modbus TCP/RTU', 'BACnet'];

const services = [
  {
    image: '/Strategic Engineering Consulting.jpeg',
    imageAlt: 'Consultation en ingénierie stratégique',
    titleKey: 'services.consulting.title',
    descKey: 'services.consulting.description',
    features: lang === 'fr' 
      ? ['Rédaction des exigences', 'Architecture système', 'Audit technique', 'Gestion d\'équipe (Traditionnelle/Agile/Scrum)', 'Accompagnement projet']
      : ['Requirements engineering', 'System architecture', 'Technical audit', 'Team leadership (Traditional/Agile/Scrum)', 'Project delivery'],
    color: 'primary'
  },
  {
    image: '/Embedded Systems & IoT.jpg',
    imageAlt: 'Systèmes embarqués et IoT',
    titleKey: 'services.embedded.title',
    descKey: 'services.embedded.description',
    features: lang === 'fr'
      ? ['Conception de cartes électroniques', 'Microcontrôleurs & FPGA', 'Firmware & bootloaders', 'Sécurité fonctionnelle & conformité']
      : ['PCB design & schematics', 'Microcontrollers & FPGA', 'Firmware & bootloaders', 'Functional safety & compliance'],
    color: 'secondary'
  },
  {
    image: '/AI & Intelligent Software.jpg',
    imageAlt: 'IA et logiciels intelligents',
    titleKey: 'services.ai.title',
    descKey: 'services.ai.description',
    features: lang === 'fr'
      ? ['Machine Learning', 'Vision par ordinateur', 'Traitement du langage', 'Automatisation intelligente']
      : ['Machine Learning', 'Computer vision', 'Natural language processing', 'Smart automation'],
    color: 'primary'
  },
  {
    image: '/Smart Energy Solutions.jpg',
    imageAlt: 'Solutions énergétiques intelligentes',
    titleKey: 'services.energy.title',
    descKey: 'services.energy.description',
    features: lang === 'fr'
      ? ['Comptage intelligent (DLMS/COSEM)', 'Monitoring énergétique', 'Modules de décision', 'Intégration système']
      : ['Smart metering (DLMS/COSEM)', 'Energy monitoring', 'Decision modules', 'System integration'],
    color: 'secondary'
  },
  {
    image: '/R&D Innovation Lab.webp',
    imageAlt: 'Laboratoire d\'innovation R&D',
    titleKey: 'services.rd.title',
    descKey: 'services.rd.description',
    features: lang === 'fr'
      ? ['Dispositifs médicaux (IEC 60601/62304)', 'Santé connectée', 'Validation sécurité critique', 'Vérification & tests']
      : ['Medical devices (IEC 60601/62304)', 'Connected health', 'Safety-critical validation', 'Verification & testing'],
    color: 'primary'
  }
];
---

<Layout 
  title={t('nav.services')}
  description={pageDescription}
  keywords={pageKeywords}
>
  <!-- Hero Section -->
  <section class="pt-32 pb-20 bg-gradient-to-br from-primary-50 via-white to-secondary-50">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900">
        {t('services.title')}
      </h1>
      <p class="mt-6 text-xl text-gray-600 max-w-3xl mx-auto">
        {t('services.subtitle')}
      </p>
    </div>
  </section>
  
  <!-- Certifications & Standards -->
  <section class="py-12 bg-white border-b border-gray-100">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center">
        <h2 class="text-2xl md:text-3xl font-bold text-gray-900">{standardsTitle}</h2>
        <p class="mt-3 text-gray-600 max-w-3xl mx-auto">{standardsSubtitle}</p>
      </div>
      <div class="mt-6 flex flex-wrap justify-center gap-3">
        {standards.map((standard) => (
          <span class="px-4 py-2 rounded-full bg-gray-50 border border-gray-200 text-sm font-semibold text-gray-700">
            {standard}
          </span>
        ))}
      </div>
      <div class="mt-8 text-center">
        <p class="text-xs font-semibold text-gray-500 uppercase tracking-widest">{protocolsTitle}</p>
        <div class="mt-3 flex flex-wrap justify-center gap-2">
          {protocols.map((protocol) => (
            <span class="px-3 py-1.5 rounded-full bg-white border border-gray-200 text-xs font-semibold text-gray-700">
              {protocol}
            </span>
          ))}
        </div>
      </div>
      <div class="mt-6 text-center">
        <a
          href={translatePath('/standards')}
          class="inline-flex items-center text-primary-600 hover:text-primary-700 font-semibold"
        >
          {standardsLink}
          <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Services List -->
  <section class="py-20 bg-white">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-5xl mx-auto mb-16">
        <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-4">
          Services spécialisés en systèmes embarqués, conception électronique, conformité et tests
        </h2>
        <p class="text-gray-600">
          Nous accompagnons vos projets de développement avec une expertise pratique en systèmes embarqués, conception
          électronique, EMI/EMC, HIL/SIL, Matlab/Simulink, qualité et analyse de risques. Notre travail couvre le médical
          (IEC 60601/62304), le comptage intelligent (DLMS/COSEM) et la sécurité fonctionnelle (IEC 61508, ISO 13849, ISO 26262).
          Nous couvrons aussi la rédaction des exigences et la gestion d'équipes en méthodes traditionnelle, Agile et Scrum.
          Basés à Lévis, nous intervenons au Québec, partout au Canada et aux États-Unis.
        </p>
      </div>
      <div class="space-y-16">
        {services.map((service, index) => (
          <div class={`flex flex-col ${index % 2 === 0 ? 'lg:flex-row' : 'lg:flex-row-reverse'} gap-12 items-center`}>
            <!-- Image -->
            <div class="flex-shrink-0 w-full lg:w-1/3">
              <div class="aspect-video max-w-md mx-auto rounded-2xl overflow-hidden shadow-xl">
                <img 
                  src={service.image} 
                  alt={service.imageAlt}
                  class="w-full h-full object-cover"
                  loading="lazy"
                />
              </div>
            </div>
            
            <!-- Content -->
            <div class="flex-1">
              <h2 class="text-3xl font-bold text-gray-900 mb-4">
                {t(service.titleKey)}
              </h2>
              <p class="text-lg text-gray-600 mb-6">
                {t(service.descKey)}
              </p>
              <ul class="grid sm:grid-cols-2 gap-3">
                {service.features.map((feature) => (
                  <li class="flex items-center gap-2">
                    <svg class={`w-5 h-5 ${service.color === 'primary' ? 'text-primary-600' : 'text-secondary-600'}`} fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-gray-700">{feature}</span>
                  </li>
                ))}
              </ul>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>
  
  <!-- Autres Expertises Section -->
  <section class="py-20 bg-white border-t border-gray-100">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900">
          {t('services.other.title')}
        </h2>
        <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">
          {t('services.other.subtitle')}
        </p>
      </div>
      <div class="grid md:grid-cols-3 gap-6">
        <div class="bg-gray-50 rounded-2xl p-8 border border-gray-100">
          <h3 class="text-xl font-semibold text-gray-900 mb-3">
            {t('services.other.card1.title')}
          </h3>
          <p class="text-gray-600">
            {t('services.other.card1.desc')}
          </p>
        </div>
        <div class="bg-gray-50 rounded-2xl p-8 border border-gray-100">
          <h3 class="text-xl font-semibold text-gray-900 mb-3">
            {t('services.other.card2.title')}
          </h3>
          <p class="text-gray-600">
            {t('services.other.card2.desc')}
          </p>
        </div>
        <div class="bg-gray-50 rounded-2xl p-8 border border-gray-100">
          <h3 class="text-xl font-semibold text-gray-900 mb-3">
            {t('services.other.card3.title')}
          </h3>
          <p class="text-gray-600">
            {t('services.other.card3.desc')}
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Process Section -->
  <section class="py-20 bg-gray-50">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900">
          {lang === 'fr' ? 'Notre Approche' : 'Our Approach'}
        </h2>
        <p class="mt-4 text-xl text-gray-600">
          {lang === 'fr' ? 'Un processus éprouvé pour des résultats exceptionnels' : 'A proven process for exceptional results'}
        </p>
      </div>
      
      <div class="flex flex-col md:flex-row items-center justify-center gap-4 md:gap-0">
        {[
          { step: '01', title: lang === 'fr' ? 'Découverte' : 'Discovery', desc: lang === 'fr' ? 'Analyse approfondie de vos besoins et objectifs' : 'In-depth analysis of your needs and goals' },
          { step: '02', title: lang === 'fr' ? 'Conception' : 'Design', desc: lang === 'fr' ? 'Élaboration de solutions sur mesure' : 'Development of tailored solutions' },
          { step: '03', title: lang === 'fr' ? 'Développement' : 'Development', desc: lang === 'fr' ? 'Réalisation avec méthodologie agile' : 'Implementation with agile methodology' },
          { step: '04', title: lang === 'fr' ? 'Livraison' : 'Delivery', desc: lang === 'fr' ? 'Déploiement et accompagnement continu' : 'Deployment and ongoing support' }
        ].map((item, index) => (
          <>
            <div class="text-center flex-1 px-4">
              <div class="w-16 h-16 mx-auto bg-gradient-to-br from-primary-600 to-primary-700 rounded-full flex items-center justify-center text-white font-bold text-xl mb-4 shadow-lg">
                {item.step}
              </div>
              <h3 class="text-xl font-semibold text-gray-900 mb-2">{item.title}</h3>
              <p class="text-gray-600 text-sm">{item.desc}</p>
            </div>
            {index < 3 && (
              <div class="flex items-center justify-center py-4 md:py-0 md:px-2">
                {/* Mobile arrow (vertical) */}
                <svg class="w-6 h-6 text-gray-400 md:hidden rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                </svg>
                {/* Desktop arrow (horizontal) */}
                <svg class="hidden md:block w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                </svg>
              </div>
            )}
          </>
        ))}
      </div>
    </div>
  </section>
  
  <!-- Case Studies Section -->
  <CaseStudies />
  
  <CTASection />
</Layout>
